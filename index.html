<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Iris Tree Classifier • Visualization</title>
<style>
  :root {
    --bg: #f9fafb;
    --text: #1f2937;
    --line: #4b5563;
    --root: #3b82f6;
    --branch: #10b981;
    --leaf-a: #f59e0b;
    --leaf-b: #ef4444;
    --leaf-c: #8b5cf6;
    --leaf-d: #14b8a6;
    --dot: #6b7280;
  }
  body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
  }
  header {
    text-align: center;
    padding: 12px;
  }
  h1 {
    margin: 0;
    font-size: 20px;
    font-weight: 700;
  }
  .board {
    max-width: 1100px;
    margin: auto;
    padding: 10px;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 6px 20px rgba(0,0,0,.08);
  }
  .controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 8px 0 14px;
  }
  button {
    padding: 8px 16px;
    font-weight: 600;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: var(--root);
    color: #fff;
  }
  button:disabled { opacity: 0.6; cursor: not-allowed; }
  #note { font-size: 13px; text-align: center; color: #6b7280; margin-bottom: 6px; }
  svg { width: 100%; height: 600px; display: block; }
  .branch { stroke: var(--line); stroke-width: 2; fill: none; }
  .node { stroke: #374151; stroke-width: 1.5; }
  .split-label { fill: var(--text); font-size: 12px; text-anchor: middle; }
  .leaf-label { font-size: 11px; text-anchor: middle; fill: #111; font-weight: bold; }
  .tip {
    position: absolute;
    pointer-events: none;
    background: #111827;
    color: #fff;
    padding: 6px 8px;
    font-size: 12px;
    border-radius: 8px;
    opacity: 0;
    transition: opacity .15s;
    transform: translate(-50%, -120%);
  }
  .tip.show { opacity: 1; }
</style>
</head>
<body>
<header>
  <h1>Iris Dataset – Decision Tree Walkthrough</h1>
</header>
<div class="board">
  <div class="controls">
    <button id="startBtn">Start Classification</button>
  </div>
  <p id="note">Ready</p>
  <svg id="canvas" viewBox="0 0 1000 600"></svg>
  <div id="hoverTip" class="tip"></div>
</div>
<script>
const NS = "http://www.w3.org/2000/svg";
const canvas = document.getElementById("canvas");
function create(tag, attrs={}, parent=canvas){
  const el = document.createElementNS(NS, tag);
  for(const [k,v] of Object.entries(attrs)) el.setAttribute(k,v);
  parent.appendChild(el);
  return el;
}
function wait(ms){ return new Promise(r=>setTimeout(r, ms)); }
function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

const colors = {
  root: getVar("--root"),
  branch: getVar("--branch"),
  leaf: {
    a: getVar("--leaf-a"), b: getVar("--leaf-b"),
    c: getVar("--leaf-c"), d: getVar("--leaf-d")
  },
  dot: getVar("--dot")
};
function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

let positions = {};
function initTree(){
  const y = {top: 100, mid: 240, bottom: 420};
  const x = {root: 500, l1: 320, r1: 680, la: 200, lb: 420, lc: 580, ld: 800};
  positions = {
    root: {x:x.root,y:y.top,label:"petal length ≤ 4.8"},
    l1:   {x:x.l1,y:y.mid,label:"sepal length ≤ 5.6"},
    r1:   {x:x.r1,y:y.mid,label:"petal width ≤ 1.75"},
    a:    {x:x.la,y:y.bottom,label:"setosa"},
    b:    {x:x.lb,y:y.bottom,label:"versicolor"},
    c:    {x:x.lc,y:y.bottom,label:"versicolor"},
    d:    {x:x.ld,y:y.bottom,label:"virginica"}
  };
}

function drawTree(){
  canvas.innerHTML="";
  line(positions.root, positions.l1);
  line(positions.root, positions.r1);
  line(positions.l1, positions.a);
  line(positions.l1, positions.b);
  line(positions.r1, positions.c);
  line(positions.r1, positions.d);

  circle(positions.root, 40, colors.root);
  circle(positions.l1, 34, colors.branch);
  circle(positions.r1, 34, colors.branch);
  circle(positions.a, 30, colors.leaf.a);
  circle(positions.b, 30, colors.leaf.b);
  circle(positions.c, 30, colors.leaf.c);
  circle(positions.d, 30, colors.leaf.d);

  text(positions.root.x, positions.root.y-45, positions.root.label,"split-label");
  text(positions.l1.x, positions.l1.y-45, positions.l1.label,"split-label");
  text(positions.r1.x, positions.r1.y-45, positions.r1.label,"split-label");
  leafText(positions.a,"a"); leafText(positions.b,"b");
  leafText(positions.c,"c"); leafText(positions.d,"d");
}

function line(a,b){ create("line",{x1:a.x,y1:a.y,x2:b.x,y2:b.y,class:"branch"}); }
function circle(p,r,fill){ create("circle",{cx:p.x,cy:p.y,r,fill,class:"node"}); }
function text(x,y,content,cls){ const t=create("text",{x,y,class:cls}); t.textContent=content; }
function leafText(node,key){ text(node.x,node.y+45,positions[key].label,"leaf-label"); }

function route(sample){
  let path=["root"];
  if(sample.pl<=4.8){
    path.push("l1");
    if(sample.sl<=5.6){ path.push("a"); return {path,leaf:"a"}; }
    else { path.push("b"); return {path,leaf:"b"}; }
  }else{
    path.push("r1");
    if(sample.pw<=1.75){ path.push("c"); return {path,leaf:"c"}; }
    else { path.push("d"); return {path,leaf:"d"}; }
  }
}

function makeDot(){ return create("circle",{r:8,fill:colors.dot,cx:-50,cy:-50}); }
async function animatePath(path,dot){
  for(let i=0;i<path.length-1;i++){
    const A=positions[path[i]], B=positions[path[i+1]];
    const steps=18, dx=(B.x-A.x)/steps, dy=(B.y-A.y)/steps;
    for(let s=0;s<=steps;s++){
      dot.setAttribute("cx",A.x+dx*s);
      dot.setAttribute("cy",A.y+dy*s);
      await wait(12);
    }
  }
}
function attachTip(dot,sample,leaf){
  const tip=document.getElementById("hoverTip");
  dot.addEventListener("mousemove",e=>{
    tip.innerHTML=`SL:${sample.sl}&nbsp;SW:${sample.sw}<br>PL:${sample.pl}&nbsp;PW:${sample.pw}<br>Species:${sample.y}<br>Leaf:${leaf.toUpperCase()}`;
    tip.style.left=e.pageX+"px";
    tip.style.top=e.pageY+"px";
    tip.classList.add("show");
  });
  dot.addEventListener("mouseleave",()=>tip.classList.remove("show"));
}

async function run(){
  btn.disabled=true;
  note.textContent="Loading data…";
  let data=[];
  try{
    const txt=await (await fetch("https://raw.githubusercontent.com/mwaskom/seaborn-data/master/iris.csv")).text();
    const rows=txt.trim().split(/\r?\n/).slice(1).map(r=>r.split(","));
    data=rows.map(c=>({sl:+c[0],sw:+c[1],pl:+c[2],pw:+c[3],y:c[4]}));
    note.textContent=`Loaded ${data.length} samples.`;
  }catch{
    data=[{sl:5.1,sw:3.5,pl:1.4,pw:0.2,y:"setosa"}];
    note.textContent="Fallback: demo sample.";
  }

  data=shuffle(data);
  for(const s of data){
    const {path,leaf}=route(s);
    const d=makeDot();
    await animatePath(path,d);
    d.setAttribute("fill",colors.leaf[leaf]);
    attachTip(d,s,leaf);
  }
  note.textContent="Done! Hover dots for info.";
  btn.disabled=false;
}

const btn=document.getElementById("startBtn");
const note=document.getElementById("note");
initTree(); drawTree();
btn.addEventListener("click",run);
</script>
</body>
</html>
